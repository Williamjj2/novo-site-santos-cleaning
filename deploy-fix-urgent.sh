#!/bin/bash

echo "üö® DEPLOY URGENTE - Corre√ß√£o Loop Infinito"
echo "========================================"

echo ""
echo "üìã EXECUTE ESTES COMANDOS NO SERVIDOR AWS:"
echo ""
echo "# 1. Navegar para o diret√≥rio do projeto"
echo "cd /var/www/novo-site-santos-cleaning"
echo ""
echo "# 2. Puxar as corre√ß√µes do GitHub"
echo "git pull origin main"
echo ""
echo "# 3. Verificar se a corre√ß√£o foi aplicada"
echo "grep -n 'useMemo.*frequencyMultipliers' frontend/src/components/PriceCalculator.js"
echo ""
echo "# 4. Fazer build de produ√ß√£o"
echo "cd frontend && npm run build && cd .."
echo ""
echo "# 5. Backup do build atual (precau√ß√£o)"
echo "sudo cp -r /var/www/santos-cleaning/frontend/build /tmp/backup-build-\$(date +%Y%m%d-%H%M%S)"
echo ""
echo "# 6. Limpar build antigo e copiar novo"
echo "sudo rm -rf /var/www/santos-cleaning/frontend/build/*"
echo "sudo cp -r frontend/build/* /var/www/santos-cleaning/frontend/build/"
echo ""
echo "# 7. Reiniciar servi√ßos"
echo "sudo systemctl reload nginx"
echo "pm2 restart all"
echo ""
echo "# 8. Verificar se hash mudou (deve ser diferente de main.d053da47.js)"
echo "curl -s http://localhost | grep -o 'main\.[a-f0-9]*\.js' | head -1"
echo ""
echo "# 9. Testar o site externamente"
echo "curl -s http://santoscsolutions.com | grep -o 'main\.[a-f0-9]*\.js' | head -1"
echo ""
echo "üéØ OBJETIVO: O hash JS deve mudar e a calculadora parar de piscar!"
echo ""
echo "‚ö†Ô∏è  Se houver problemas, o backup est√° em /tmp/backup-build-*" 